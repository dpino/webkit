<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>scrollbar-gutter: content box width stability test</title>
  <style>
    #test {
      overflow: auto;
      scrollbar-gutter: stable;
      width: 200px;
      height: 100px;
      border: 2px solid black;
      background: lightblue;
    }

    .content {
      width: 100%;
      height: 200px;
      background: orange;
    }

    #test::-webkit-scrollbar {
      width: 20px;
      background-color: #f0f0f0;
    }

    #test::-webkit-scrollbar-thumb {
      background-color: #888;
      border-radius: 4px;
      border: 3px solid #f0f0f0;
    }

    #test::-webkit-scrollbar-thumb:hover {
      background-color: #555;
    }
  </style>
</head>
<body>
<pre id="result">FAIL: test did not run</pre>

<div id="test">
  <div class="content">When scrollbar-gutter: stable is set, the content width remains the same even when overflow changes from auto to hidden, because the gutter area is preserved and not removed with the scrollbar</div>
</div>

<script>
  if (window.testRunner) {
    testRunner.dumpAsText();
    testRunner.waitUntilDone();
  }

  const content = document.querySelector('.content');
  const container = document.getElementById('test');
  const resultEl = document.getElementById('result');
  let before;

  function measureBefore() {
    before = content.clientWidth;
    container.style.overflow = 'hidden';
    requestAnimationFrame(measureAfter);
  }

  function measureAfter() {
    const after = content.clientWidth;

    resultEl.textContent = (before === after) ? 'PASS' : 'FAIL';

    if (window.testRunner)
      testRunner.notifyDone();
  }

  window.addEventListener('load', () => {
    requestAnimationFrame(measureBefore);
  });
</script>
</body>
</html>
